#!/bin/bash

source `dirname $0`/../colors.bash
source `dirname $0`/../git.bash

git_pager() {
        if test -t 1
        then
                GIT_PAGER=$(git var GIT_PAGER)
        else
                GIT_PAGER=cat
        fi
        : ${LESS=-FRSX}
        export LESS
        eval "$GIT_PAGER" '"$@"'
}

while read line; do (
  cd $line;
  wd=$(pwd);
  echo -e "${LIGHT_BLUE}${wd/$HOME/~}${NC}";
  git --no-pager log --pretty=tformat:'%C(bold red)%d%Creset %s %C(bold magenta)<%an> %Cgreen(%cr)%Creset' --date=relative ..@{upstream};  
) done <$HOME/.mgitrepos | git_pager
